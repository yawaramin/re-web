<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Server (re-web.ReWeb.Server)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">re-web</a> &#x00BB; <a href="../index.html">ReWeb</a> &#x00BB; Server</nav><header class="odoc-preamble"><h1>Module <code><span>ReWeb.Server</span></code></h1><p>Create and serve endpoints.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Request" class="anchored"><a href="#module-Request" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Request/index.html">Request</a></span><span> : <a href="Request/module-type-S/index.html">Request.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="Request/module-type-S/Reqd/index.html#type-t">Reqd.t</a> = <span class="xref-unresolved">Httpaf</span>.Reqd.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Service" class="anchored"><a href="#module-Service" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Service/index.html">Service</a></span><span> : <a href="Service/module-type-S/index.html">Service.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="Service/module-type-S/Request/Reqd/index.html#type-t">Request.Reqd.t</a> = <span class="xref-unresolved">Httpaf</span>.Reqd.t</span> <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'ctx <a href="Service/module-type-S/Request/index.html#type-t">Request.t</a></span> = <span><span class="type-var">'ctx</span> <a href="Request/index.html#type-t">Request.t</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Filter" class="anchored"><a href="#module-Filter" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Filter/index.html">Filter</a></span><span> : <a href="Filter/module-type-S/index.html">Filter.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="Filter/module-type-S/Service/Request/Reqd/index.html#type-t">Service.Request.Reqd.t</a> = <span class="xref-unresolved">Httpaf</span>.Reqd.t</span> <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'ctx <a href="Filter/module-type-S/Service/Request/index.html#type-t">Service.Request.t</a></span> = <span><span class="type-var">'ctx</span> <a href="Request/index.html#type-t">Request.t</a></span></span> <span class="keyword">and</span> <span><span class="keyword">type</span>
<span>('ctx, 'resp) <a href="Filter/module-type-S/Service/index.html#type-t">Service.t</a></span> = <span><span>(<span class="type-var">'ctx</span>, <span class="type-var">'resp</span>)</span> <a href="Service/index.html#type-t">Service.t</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-path" class="anchored"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-route" class="anchored"><a href="#type-route" class="anchor"></a><code><span><span class="keyword">type</span> route</span><span> = <span class="xref-unresolved">Httpaf</span>.Method.t * <a href="#type-path">path</a></span></code></div><div class="spec-doc"><p>Pattern-matchable identifier of the request for routing purposes. Consists of:</p><ul><li>HTTP method e.g. <code>`GET</code>, <code>`POST</code></li><li><code>path</code> i.e. a list of path segments</li></ul><p>E.g., <code>GET /api/user/1</code> would be represented as <code>(`GET, [&quot;api&quot;, &quot;user&quot;, &quot;1&quot;])</code></p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('ctx, 'resp) t</span></span><span> = <span><a href="#type-route">route</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'ctx</span>, <span class="type-var">'resp</span>)</span> <a href="Service/index.html#type-t">Service.t</a></span></span></code></div><div class="spec-doc"><p>A server is a function that takes a <code>route</code> and returns a service. A route is pattern-matchable (see above), so you will almost always do that to handle different endpoints with different services.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-resource" class="anchored"><a href="#val-resource" class="anchor"></a><code><span><span class="keyword">val</span> resource : <span>?index:<span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?create:<span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span> <span class="arrow">&#45;&gt;</span></span> <span>?new_:<span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span> <span class="arrow">&#45;&gt;</span></span>
<span>?edit:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>?show:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
<span>?update:<span>(<span><span>[ `PATCH <span>| `PUT</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>?destroy:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-route">route</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'ctx</span> <a href="Service/index.html#type-all">Service.all</a></span></span></code></div><div class="spec-doc"><p><code>resource(?index, ?create, ?new_, ?edit, ?show, ?update, ?destroy)</code> returns a resource--that is a server--with the standard HTTP CRUD actions that you specify as services. The resource handles the paths and sets a reasonable cache policy corresponding to those CRUD actions:</p><ul><li><code>GET /scope</code> or <code>GET /scope/</code> calls <code>index</code></li><li><code>POST /scope</code> calls <code>create</code> and disables caching</li><li><code>GET /scope/new</code> or <code>GET /scope/new/</code> calls <code>new_</code> and sets the response to cache publicly for a week</li><li><code>GET /scope/id/edit</code> or <code>GET /scope/id/edit/</code> calls <code>edit id</code></li><li><code>GET /scope/id</code> or <code>GET /scope/id/</code> calls <code>show id</code></li><li><code>PATCH /scope/id</code> calls <code>update `PATCH id</code> and disables caching</li><li><code>PUT /scope/id</code> calls <code>update `PUT id</code> and disables caching</li><li><code>DELETE /scope/id</code> calls <code>destroy id</code> and disables caching</li></ul><p>The <code>scope</code> above is whatever scope you put the resource inside in a parent router, or maybe even the toplevel scope <code>/</code> if you use the resource directly as your toplevel server.</p><p>All the service parameters are optional, with a 404 Not Found response as the default. Note that <code>resource</code> is just a convenience function; you can implement a custom resource yourself if needed, by creating a server function of type <code>('ctx, 'resp) t</code> instead.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-serve" class="anchored"><a href="#val-serve" class="anchor"></a><code><span><span class="keyword">val</span> serve : <span>?port:int <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span>[ <a href="../Response/index.html#type-http">Response.http</a> <span>| <a href="../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>serve(?port, server)</code> starts the top-level <code>server</code> listening on <code>port</code>. Top-level servers must have no context i.e. their context is <code>()</code>.</p></div></div></div></body></html>